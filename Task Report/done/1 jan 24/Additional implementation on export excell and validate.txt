Controller 222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
app\Http\Controllers\TimesheetController.php
replace this function searchingtimesheet(Request $request)


 public function searchingtimesheet(Request $request)
  {
    // dd($request);
    // Get all input from form
    $startDate = $request->input('startdate', null);
    $endDate = $request->input('enddate', null);
    $teamId = $request->input('teamid', null);
    $year = $request->input('year', null);

    // this is for patner
    if (auth()->user()->role_id == 13) {

      if (($startDate != null && $endDate != null) || $request->year != null) {
        $timesheetData = DB::table('timesheetusers')
          ->leftjoin('teammembers', 'teammembers.id', 'timesheetusers.createdby')
          // When startDate and endDate exist then run 'when' clouse
          ->when($startDate && $endDate, function ($query) use ($startDate, $endDate, $teamId) {
            return $query->where('timesheetusers.createdby', $teamId)
              ->where('timesheetusers.date', '>=', $startDate)
              ->where('timesheetusers.date', '<=', $endDate);
          })
          // When year exist then run 'when' clouse
          ->when($year, function ($query) use ($year, $teamId) {
            // convert startyear (2023) in full date like 01-01-2023
            $startYear = Carbon::createFromFormat('Y', $year)->startOfYear();
            // convert endYear (2023) in full date like 31-12-2023
            $endYear = Carbon::createFromFormat('Y', $year)->endOfYear();
            return $query->where('timesheetusers.createdby', $teamId)
              ->where('timesheetusers.date', '>=', $startYear)
              ->where('timesheetusers.date', '<=', $endYear);
          })
          ->whereIn('timesheetusers.status', [1, 2, 3])
          ->select('timesheetusers.*', 'teammembers.team_member')
          ->orderBy('date', 'DESC')
          ->get();
        // dd($timesheetData);
        $request->flash();
        return view('backEnd.timesheet.timesheetdownload', compact('timesheetData'));
      }
    }
    // this is for staff and manager
    else {
      if (($startDate != null && $endDate != null) || $request->year != null) {
        $timesheetData = DB::table('timesheetusers')
          ->leftjoin('teammembers', 'teammembers.id', 'timesheetusers.createdby')
          // When startDate and endDate exist then run 'when' clouse
          ->when($startDate && $endDate, function ($query) use ($startDate, $endDate, $teamId) {
            return $query->where('timesheetusers.createdby', $teamId)
              ->where('timesheetusers.date', '>=', $startDate)
              ->where('timesheetusers.date', '<=', $endDate);
          })
          // When year exist then run 'when' clouse
          ->when($year, function ($query) use ($year, $teamId) {
            // convert startyear (2023) in full date like 01-01-2023
            $startYear = Carbon::createFromFormat('Y', $year)->startOfYear();
            // convert endYear (2023) in full date like 31-12-2023
            $endYear = Carbon::createFromFormat('Y', $year)->endOfYear();
            return $query->where('timesheetusers.createdby', $teamId)
              ->where('timesheetusers.date', '>=', $startYear)
              ->where('timesheetusers.date', '<=', $endYear);
          })
          ->whereIn('timesheetusers.status', [1, 2, 3])
          ->select('timesheetusers.*', 'teammembers.team_member')
          ->orderBy('date', 'DESC')
          ->get();
        $request->flash();
        return view('backEnd.timesheet.timesheetdownload', compact('timesheetData'));
      }
    }
    return '<h3>Please Choose Searching date or year</h3>';
  }






Blade 222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222
resources\views\backEnd\timesheet\timesheetdownload.blade.php

find text   <form method="post" action="{{ url('searchingtimesheet') }}" enctype="multipart/form-data"
replace form tag 


                      <form method="post" action="{{ url('searchingtimesheet') }}" enctype="multipart/form-data"
                          class="form-inline">
                          @csrf
                          <table class="table table-bordered table-striped">
                              <thead>
                                  <tr>
                                      <th>Year <span class="text-danger">*</span></th>
                                      <th>Start Date <span class="text-danger">*</span></th>
                                      <th>End Date <span class="text-danger">*</span></th>
                                      {{-- <th>Teamid</th> --}}
                                      <th>Action</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  <tr style=" background-color: white;">
                                      <td>
                                          <div class="form-group">
                                              <select class="language form-control" id="year" name="year">
                                                  <option value="">Please Select One</option>
                                                  <option value="2024" {{ old('year') == '2024' ? 'selected' : '' }}>2024
                                                  </option>
                                                  <option value="2023" {{ old('year') == '2023' ? 'selected' : '' }}>2023
                                                  </option>
                                              </select>
                                          </div>
                                      </td>
                                      <td>
                                          <div class="form-group">
                                              <input type="date" class="form-control" id="startdate" name="startdate"
                                                  value="{{ old('startdate') }}">
                                          </div>
                                      </td>
                                      <td>
                                          <div class="form-group">
                                              <input type="date" class="form-control" id="enddate" name="enddate"
                                                  value="{{ old('enddate') }}">
                                          </div>
                                      </td>
                                      <td style="display: none">
                                          <div class="form-group">
                                              @php

                                                  $displayedValues = [];
                                              @endphp
                                              @foreach ($timesheetData as $timesheetDatas)
                                                  @if (!in_array($timesheetDatas->createdby, $displayedValues))
                                                      <input type="hidden" class="form-control" id="teamid"
                                                          name="teamid" value="{{ $timesheetDatas->createdby }}">
                                                      @php
                                                          $displayedValues[] = $timesheetDatas->createdby;
                                                      @endphp
                                                  @endif
                                              @endforeach
                                          </div>
                                      </td>
                                      <td>
                                          <button type="submit" class="btn btn-success">Search</button>
                                      </td>
                                  </tr>
                              </tbody>
                          </table>
                      </form>



################################################################################################################################
find this code in same file and after style tag remove all javascript code and add below javascript code

  <style>
      .dt-buttons {
          margin-bottom: -34px;
      }
  </style>




  <script>
      $(document).ready(function() {
          $('#examplee').DataTable({
              dom: 'Bfrtip',
              "order": [
                  //   [0, "DESC"]
                  //   [2, "DESC"]
              ],
              buttons: [{
                      extend: 'copyHtml5',
                      exportOptions: {
                          columns: [0, ':visible']
                      }
                  },
                  {
                      extend: 'excelHtml5',
                      filename: 'Timesheet_Download',
                      exportOptions: {
                          columns: ':visible'
                      },
                      customize: function(xlsx) {
                          var sheet = xlsx.xl.worksheets['sheet1.xml'];

                          //   set column width
                          $('col', sheet).eq(0).attr('width', 15);
                          $('col', sheet).eq(1).attr('width', 15);
                          $('col', sheet).eq(3).attr('width', 30);
                          $('col', sheet).eq(4).attr('width', 30);
                          $('col', sheet).eq(5).attr('width', 30);
                          $('col', sheet).eq(6).attr('width', 30);
                          $('col', sheet).eq(7).attr('width', 30);
                          //   remove extra spaces
                          $('c', sheet).each(function() {
                              var originalText = $(this).find('is t').text();
                              var cleanedText = originalText.replace(/\s+/g, ' ').trim();
                              $(this).find('is t').text(cleanedText);
                          });
                      }
                  },

                  {
                      extend: 'pdfHtml5',
                      filename: 'Timesheet Download',
                      exportOptions: {
                          columns: [1, 2, 3, 4, 5]
                      }
                  },
                  'colvis'
              ]
          });
      });
  </script>


  {{-- validation for comparision date and block year for 4 disit --}}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
      $(document).ready(function() {
          var startDateInput = $('#startdate');
          var endDateInput = $('#enddate');

          function compareDates() {
              var startDate = new Date(startDateInput.val());
              var endDate = new Date(endDateInput.val());

              if (startDate > endDate) {
                  alert('End date should be greater than or equal to the Start date');
                  endDateInput.val(''); // Clear the end date input
              }
          }

          startDateInput.on('input', compareDates);
          endDateInput.on('blur', compareDates);
      });
  </script>

  {{-- validation for block 4 digit to  year --}}
  <script>
      $(document).ready(function() {
          $('#startdate').on('change', function() {
              var startclear = $('#startdate');
              var startDateInput1 = $('#startdate').val();
              var startDate = new Date(startDateInput1);
              var startyear = startDate.getFullYear();
              var yearLength = startyear.toString().length;
              if (yearLength > 4) {
                  alert('Enter four digits for the year');
                  startclear.val('');
              }
              //   validation for year match
              var yearvalue = $('#year').val();
              if (yearvalue != startyear) {
                  alert('Enter Start Date According Year');
                  startclear.val('');
              }
          });
          $('#enddate').on('change', function() {
              var endclear = $('#enddate');
              var endDateInput1 = $('#enddate').val();
              var endtDate = new Date(endDateInput1);
              var endyear = endtDate.getFullYear();
              var endyearLength = endyear.toString().length;
              if (endyearLength > 4) {
                  alert('Enter four digits for the year');
                  endclear.val('');
              }
              //   validation for year match
              var yearvalue = $('#year').val();
              if (yearvalue != endyear) {
                  alert('Enter End Date According Year');
                  endclear.val('');
              }
          });
      });
  </script>








################################################################################################################################
